<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>VA_GStreamer_Plugins: GStreamer Video Analytics plugin documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">VA_GStreamer_Plugins
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">GStreamer Video Analytics plugin documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This documentation describes Gstreamer Video Analytics interfaces to access and control GStreamer metadata, which contains models tensors as a result of inference with GStreamer elements, such as <b>gvainference/gvadetect/gvaclassify</b>.</p>
<p>Inference plugins utilize <a href="https://github.com/GStreamer/gst-plugins-base/blob/master/gst-libs/gst/video/gstvideometa.h#L275">standard GStreamer metadata <b>GstVideoRegionOfInterestMeta</b></a> for object detection, classification and recognition use cases (elements <b>gvadetect, gvaclassify, gvaidentify</b>), and define two custom metadata types</p><ul>
<li><a class="el" href="struct__GstGVATensorMeta.html" title="This struct represents raw tensor metadata and contains instance of parent GstMeta and fields describ...">_GstGVATensorMeta</a> for output of <b>gvainference</b> element performing generic inference on any model with image-compatible input layer and any format of output layer(s)</li>
<li><a class="el" href="struct__GstGVAJSONMeta.html" title="This struct represents JSON metadata and contains instance of parent GstMeta and message. ">_GstGVAJSONMeta</a> for output of <b>gvametaconvert</b> element performing <a href="https://github.com/GStreamer/gst-plugins-base/blob/master/gst-libs/gst/video/gstvideometa.h#L275"><b>GstVideoRegionOfInterestMeta</b></a> conversion into JSON format</li>
</ul>
<p>The <b>gvadetect</b> element supports only object detection models and checks model output layer to have known format convertable into bounding boxes list. The gvadetect element creates and attaches to output GstBuffer as many instances of <a href="https://github.com/GStreamer/gst-plugins-base/blob/master/gst-libs/gst/video/gstvideometa.h#L275">GstVideoRegionOfInterestMeta</a> as objects detected on the frame. The object bounding-box position and object label stored directly in <a href="https://github.com/GStreamer/gst-plugins-base/blob/master/gst-libs/gst/video/gstvideometa.h#L275">GstVideoRegionOfInterestMeta</a> fields 'x','y','w','h','roi_type', while additional detection information such as confidence (in range [0,1]), model name and output layer name stored as GstStructure object and added into 'GList *params' list of the same <a href="https://github.com/GStreamer/gst-plugins-base/blob/master/gst-libs/gst/video/gstvideometa.h#L275">GstVideoRegionOfInterestMeta</a>.</p>
<p>The <b>gvaclassify</b> element typically inserted into pipeline after gvadetect and executes inference on all objects detected by gvadetect (i.e as many times as <a href="https://github.com/GStreamer/gst-plugins-base/blob/master/gst-libs/gst/video/gstvideometa.h#L275">GstVideoRegionOfInterestMeta</a> attached to input buffer) with input on crop area specified by <a href="https://github.com/GStreamer/gst-plugins-base/blob/master/gst-libs/gst/video/gstvideometa.h#L275">GstVideoRegionOfInterestMeta</a>. The inference output converted into as many GstStructure objects as number of output layers in the model and added into 'GList *params' list of the <a href="https://github.com/GStreamer/gst-plugins-base/blob/master/gst-libs/gst/video/gstvideometa.h#L275">GstVideoRegionOfInterestMeta</a>. Each GstStructure contains full inference results such as tensor data and dimensions, model and layer names, and label in string format (if post-processing rules specified).</p>
<p>The <b>gvainference</b> element generates and attaches to the frame custom metadata <a class="el" href="struct__GstGVATensorMeta.html" title="This struct represents raw tensor metadata and contains instance of parent GstMeta and fields describ...">_GstGVATensorMeta</a> (as many instances as output layers in the model) containing tensor raw data and additional information such as tensor dimensions, data precision, etc.</p>
<p>Taking the following pipeline as example: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;MODEL1=face-detection-adas-0001</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;MODEL2=age-gender-recognition-retail-0013</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;MODEL3=emotions-recognition-retail-0003</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;gst-launch-1.0 --gst-plugin-path ${GST_PLUGIN_PATH} \</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    filesrc location=${INPUT} ! decodebin ! video/x-raw ! videoconvert ! \</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    gvadetect   model=$(MODEL_PATH $MODEL1) ! queue ! \</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    gvaclassify model=$(MODEL_PATH $MODEL2) model-proc=$(PROC_PATH $MODEL2) ! queue ! \</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    gvaclassify model=$(MODEL_PATH $MODEL3) model-proc=$(PROC_PATH $MODEL3) ! queue ! \</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    gvawatermark ! videoconvert ! fpsdisplaysink video-sink=xvimagesink sync=false</div></div><!-- fragment --><p> The gvadetect detected three faces, it will attach three metadata objects each containing one GstStructure with detection results, the next gvaclassify will add two more GstStructure (model contains two output layers, age and gender) into each meta, and another gvaclassify will add one more GstStructure (emotion), resulting in three metadata objects each containing four GstStructure in 'GList *params' field: detection, age, gender, emotions.</p>
<p>"C"/C++ application can iterate objects and inference results using GStreamer API similar to code snapshot below </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;#include &lt;gst/video/video.h&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;void print_meta(GstBuffer *buffer) {</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    gpointer state = NULL;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    GstMeta *meta = NULL;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    while ((meta = gst_buffer_iterate_meta(buffer, &amp;state)) != NULL) {</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        if (meta-&gt;info-&gt;api != GST_VIDEO_REGION_OF_INTEREST_META_API_TYPE)</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;            continue;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        GstVideoRegionOfInterestMeta *roi_meta = (GstVideoRegionOfInterestMeta*)meta;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        printf(&quot;Object bounding box %d,%d,%d,%d\n&quot;, roi_meta-&gt;x, roi_meta-&gt;y, roi_meta-&gt;w, roi_meta-&gt;h);</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        for (GList *l = roi_meta-&gt;params; l; l = g_list_next(l)) {</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;            GstStructure *structure = (GstStructure *) l-&gt;data;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;            printf(&quot;  Attribute %s\n&quot;, gst_structure_get_name(structure));</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;            if (gst_structure_has_field(structure, &quot;label&quot;)) {</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;                printf(&quot;    label=%s\n&quot;, gst_structure_get_string(structure, &quot;label&quot;));</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;            }</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;            if (gst_structure_has_field(structure, &quot;confidence&quot;)) {</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;                double confidence;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;                gst_structure_get_double(structure, &quot;confidence&quot;, &amp;confidence);</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;                printf(&quot;    confidence=%.2f\n&quot;, confidence);</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;            }</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        }</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    }</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;}</div></div><!-- fragment --><p>For C++ application the the header-only C++ utility <a class="el" href="gva__roi__meta_8h.html" title="This file contains classes &amp; functions to control GVA::RegionOfInterest and GVA::Tensor instances...">gva_roi_meta.h</a> helps to simplify the code above by C++ classes with get/set functions and C++ iterators for <a href="https://github.com/GStreamer/gst-plugins-base/blob/master/gst-libs/gst/video/gstvideometa.h#L275">GstVideoRegionOfInterestMeta</a>. <a class="el" href="classGVA_1_1RegionOfInterest.html" title="This class represents region of interest - object with multiple tensors attached by multiple models (...">GVA::RegionOfInterest</a> and <a class="el" href="classGVA_1_1RegionOfInterestList.html" title="This class represents vector of regions of interest. ">GVA::RegionOfInterestList</a> are classes to refer and interate through metadata accordingly. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;#include &quot;gva_roi_meta.h&quot;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;void PrintMeta(GstBuffer *buffer) {</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    GVA::RegionOfInterestList roi_list(buffer);</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    for (GVA::RegionOfInterest &amp;roi : roi_list) {</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        GstVideoRegionOfInterestMeta *meta = roi.meta();</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        std::cout &lt;&lt; &quot;Object bounding box &quot; &lt;&lt; meta-&gt;x &lt;&lt; &quot;,&quot; &lt;&lt; meta-&gt;y &lt;&lt; &quot;,&quot; &lt;&lt; meta-&gt;w &lt;&lt; &quot;,&quot; &lt;&lt; meta-&gt;h &lt;&lt; &quot;,&quot; &lt;&lt; std::endl;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        for (GVA::Tensor &amp;tensor : roi) {</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;            std::cout &lt;&lt; &quot;  Attribute &quot; &lt;&lt; tensor.name() &lt;&lt; std::endl;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;            std::cout &lt;&lt; &quot;    label=&quot; &lt;&lt; tensor.label() &lt;&lt; std::endl;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;            std::cout &lt;&lt; &quot;    confidence=&quot; &lt;&lt; tensor.confidence() &lt;&lt; std::endl;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        }</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    }</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;}</div></div><!-- fragment --><p>The following table summarizes the input and output of various elements</p>
<table class="doxtable">
<tr>
<th>GStreamer element </th><th>Description </th><th>INPUT </th><th>OUTPUT  </th></tr>
<tr>
<td>gvainference </td><td>Generic inference</td><td>GstBuffer </td><td>INPUT + <a class="el" href="struct__GstGVATensorMeta.html" title="This struct represents raw tensor metadata and contains instance of parent GstMeta and fields describ...">_GstGVATensorMeta</a> </td></tr>
<tr>
<td>gvadetect</td><td>Object detection</td><td>GstBuffer</td><td>INPUT + <a href="https://github.com/GStreamer/gst-plugins-base/blob/master/gst-libs/gst/video/gstvideometa.h#L275">GstVideoRegionOfInterestMeta</a> </td></tr>
<tr>
<td>gvaclassify</td><td>Object classification</td><td>GstBuffer + <a href="https://github.com/GStreamer/gst-plugins-base/blob/master/gst-libs/gst/video/gstvideometa.h#L275">GstVideoRegionOfInterestMeta</a> </td><td>INPUT + extended <a href="https://github.com/GStreamer/gst-plugins-base/blob/master/gst-libs/gst/video/gstvideometa.h#L275">GstVideoRegionOfInterestMeta</a> </td></tr>
<tr>
<td>gvametaconvert</td><td>Metadata conversion </td><td>GstBuffer + <a href="https://github.com/GStreamer/gst-plugins-base/blob/master/gst-libs/gst/video/gstvideometa.h#L275">GstVideoRegionOfInterestMeta</a> </td><td>INPUT + <a class="el" href="struct__GstGVAJSONMeta.html" title="This struct represents JSON metadata and contains instance of parent GstMeta and message. ">_GstGVAJSONMeta</a> </td></tr>
<tr>
<td>gvawatermark</td><td>Overlay</td><td>GstBuffer + <a href="https://github.com/GStreamer/gst-plugins-base/blob/master/gst-libs/gst/video/gstvideometa.h#L275">GstVideoRegionOfInterestMeta</a> </td><td>- </td></tr>
</table>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
